<!doctype html>
<html lang="en">
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!--JQuery-->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
  <!--Bootstrap/CSS Import-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <link rel="stylesheet" href="act.css" class="rel">
  <link rel="stylesheet" href="responsive.css" class="rel">
  <!--Fonts-->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Covered+By+Your+Grace&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
    rel="stylesheet">
  <!--Tab Title-->
  <title>Act Together</title>
</head>

<body>
  <div class="container-flex">
    <!--NAVBAR-->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark shadow-sm"
      style="background-color: #FFA69E; padding: 1.2em 2em;">

      <a class="navbar-brand" href="index.html"><img src="img/LogoWhite_Small.png"
          style="height: 60px; width: auto;"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
        aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="act.html">Act</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="create.html">Create</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="inspire.html">Inspire</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="about.html">About</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="contact.html">Contact</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="antiracism.html">Anti-Racism</a>
          </li>
        </ul>
      </div>
    </nav>

    <!--FILTERS-->
    <div class="container" style="margin-top: 150px">
      <div class="section-header">ACT TOGETHER</div>
      <div class="body-text">Use our collection of efforts to see how you can help in your area.</div>

      <div class="row align-items-center mt-5">
        <div class="col">
          <select id="state_zip_input" class="form-control" placeholder="State or ZIP">

            <option value="Alabama">Alabama</option>
            <option value="Alaska">Alaska</option>
            <option value="Arizona">Arizona</option>
            <option value="Arkansas">Arkansas</option>
            <option value="California">California</option>
            <option value="Colorado">Colorado</option>
            <option value="Connecticut">Connecticut</option>
            <option value="Delaware">Delaware</option>
            <option value="DC">District Of Columbia</option>
            <option value="Florida">Florida</option>
            <option value="Georgia">Georgia</option>
            <option value="Hawaii">Hawaii</option>
            <option value="Idaho">Idaho</option>
            <option value="Illinois">Illinois</option>
            <option value="Indiana">Indiana</option>
            <option value="Iowa">Iowa</option>
            <option value="Kansas">Kansas</option>
            <option value="Kentucky">Kentucky</option>
            <option value="Louisiana">Louisiana</option>
            <option value="Maine">Maine</option>
            <option value="Maryland">Maryland</option>
            <option value="Massachusetts">Massachusetts</option>
            <option value="Michigan">Michigan</option>
            <option value="Minnesota">Minnesota</option>
            <option value="Mississippi">Mississippi</option>
            <option value="Missouri">Missouri</option>
            <option value="Montana">Montana</option>
            <option value="Nebraska">Nebraska</option>
            <option value="Nevada">Nevada</option>
            <option value="New Hampshire">New Hampshire</option>
            <option value="New Jersey">New Jersey</option>
            <option value="New Mexico">New Mexico</option>
            <option value="New York" selected>New York</option>
            <option value="North Carolina">North Carolina</option>
            <option value="North Dakota">North Dakota</option>
            <option value="Ohio">Ohio</option>
            <option value="Oklahoma">Oklahoma</option>
            <option value="Oregon">Oregon</option>
            <option value="Pennsylvania">Pennsylvania</option>
            <option value="Rhode Island">Rhode Island</option>
            <option value="South Carolina">South Carolina</option>
            <option value="South Dakota">South Dakota</option>
            <option value="Tennessee">Tennessee</option>
            <option value="Texas">Texas</option>
            <option value="Utah">Utah</option>
            <option value="Vermont">Vermont</option>
            <option value="Virginia">Virginia</option>
            <option value="Washington">Washington</option>
            <option value="West Virginia">West Virginia</option>
            <option value="Wisconsin">Wisconsin</option>
            <option value="Wyoming">Wyoming</option>
          </select>
        </div>
        <div class="col col-lg-2"><input class="btn btn-primary"
            onclick="entry(document.getElementById('state_zip_input').value)" type="submit" value="Filter"></div>
      </div>
    </div>
  </div>

  <!--RESULTS-->
  <div class="container my-5" id="card_container"></div>

  <!--FOOTER-->
  <div class="container-flex" style="background-color: #FFA69E; height: 200px; overflow: hidden;">
    <div class="row" style="margin-top: 2%;">
      <div class="col-2"></div>
      <div class="col-2">
        <h6><b>Isolating Together</b></h6>
        <a href="act.html">
          <h6>Act</h6>
        </a>
        <a href="create.html">
          <h6>Create</h6>
        </a>
        <a href="inspire.html">
          <h6>Inspire</h6>
        </a>
      </div>
      <div class="col-2"></div>
      <div class="col-2">
        <a href="about.html">
          <h6>About</h6>
        </a>
        <a href="contact.html">
          <h6>Contact</h6>
        </a>
        <a href="#">
          <h6>Twitter</h6>
        </a>
        <a href="#">
          <h6>Instagram</h6>
        </a>
      </div>
      <div class="col-2"></div>
    </div>
  </div>

  <template>
    <div class="col">
      <div class="card">
        <a id="temp-link" href="">
          <img id="temp-img" class="card-img-top" src="img/helper.jpg" alt="Card image cap">
          <div class="card-body">
            <h5 id="temp-title" class="card-title"></h5>
        </a>
        <p class="card-text"><small id="temp-location" class="text-muted"></small></p>
        <p id="temp-desc" class="card-text"></p>
        <!-- <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p> -->
      </div>
    </div>
    </div>
  </template>

  <!--XLSX Reader-->
  <script type="text/javascript" lang="javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.1/xlsx.full.min.js"></script>

  <!-- Resize script -->
  <script>
    x = 0;
    $(document).ready(function () {
      $(window).resize(function () {
        onResize();
      });
    });
  </script>

  <script>
    function getWidth() {
      var viewWidth;

      // the more standards compliant browsers (mozilla/netscape/opera/IE7) use window.innerWidth and window.innerHeight
      if (typeof window.innerWidth != 'undefined') {
        viewWidth = window.innerWidth;
      }

      // IE6 in standards compliant mode (i.e. with a valid doctype as the first line in the document)
      else if (typeof document.documentElement != 'undefined' &&
        typeof document.documentElement.clientWidth != 'undefined' && document.documentElement.clientWidth != 0) {
        viewPortWidth = document.documentElement.clientWidth;
      }

      // older versions of IE
      else {
        viewPortWidth = document.getElementsByTagName('body')[0].clientWidth;
      }
      return viewWidth;
    }

    // set our variables
    const filePath = "./data/States.xlsx";
    var viewer = document.getElementById('dataviewer');
    var data = [];
    var currWidth = getWidth();
    var widthLimit = 1200;
    var width;

    if (currWidth > widthLimit) {
      width = 3;
    } else {
      width = 1;
    }

    function importFile(state) {
      // use loading function to get file from server-side
      fetch(filePath).then(function (res) {
          // data as arraybuffer
          if (!res.ok) throw new Error("importing failed");
          return res.arrayBuffer();
        })
        .then(function (ab) {
          // received data async. now parse ab = ArrayBuffer
          var data = new Uint8Array(ab);
          var workbook = XLSX.read(data, {
            type: "array"
          });

          // TODO: reformat the input to be state with Capital letter

          //have the workbook. Now use the input state and get a json from the sheet
          var worksheet = workbook.Sheets[state];
          var _JsonData = XLSX.utils.sheet_to_json(worksheet, {
            raw: true
          });

          clearCards(_JsonData.length);
          _JsonData.forEach(createCard);

          data = _JsonData;
        });
    }
    /* now could take the json data and make something from it in the
    dataviewer division */

    // this will be our entry point to the parsing
    function entry(state) {
      importFile(state);
    }

    //TODO: needs to prettied up
    function clearCards(len) {
      var cards = document.getElementById("card_container");

      if (len == 0) {
        cards.innerHTML = "<p>No cards found.</p>";
      } else {
        cards.innerHTML = "";
      }
    }

    function onResize() {
      currWidth = getWidth();
      console.log("resize to " + currWidth);
      if (currWidth < widthLimit && width == 3) {
        console.log("switch to 1");
        width = 1;
        clearCards();
        data.forEach(createCard);
      } else if (currWidth > widthLimit && width == 1) {
        console.log("switch to 3");
        width = 3;
        clearCards();
        data.forEach(createCard);
      }
    }

    function createCard(item, index) {
      var cards = document.getElementById("card_container");
      data[index] = item;

      var row_id = "row" + Math.trunc(index / width);

      if (index % width == 0) {
        if (index != 0) {
          cards.innerHTML += '</div>';
        }

        cards.innerHTML += '<div class="row" id="' + row_id + '" >';
      }

      var temp = document.getElementsByTagName("template")[0];
      var clone = temp.content.cloneNode(true);

      //Update Title
      if (item.hasOwnProperty("Name")) {
        var title = clone.getElementById("temp-title");
        title.id += index;
        title.innerText = item["Name"];
      }

      //Update Description
      if (item.hasOwnProperty("Details")) {
        var desc = clone.getElementById("temp-desc");
        desc.id += index;
        desc.innerText = item["Details"];
      }

      //Update Image ID and Tag if needed
      var img = clone.getElementById("temp-img");
      img.id += index;

      if (item.hasOwnProperty("Type")) {
        var tag = item["Type"];

        if (tag == "Mutual Aid") {
          img.src = "img/act/mutualAid.jpeg";
        } else if (tag == "Donate") {
          img.src =
            "https://raw.githubusercontent.com/reyluno/isolatingtogether.github.io/firebase-setup/public/img/act/donation.jpeg";
        } else if (tag == "Volunteer") {
          img.src = "img/act/volunteer.jpg";
        } else if (tag == "Central Resource") {
          img.src = "img/act/centralResource.jpeg";
        }
      }

      //Update Location
      if (item.hasOwnProperty("Location")) {
        var location = clone.getElementById("temp-location");
        location.id += index;
        location.innerText = item["Location"];
      }

      //Update Img/Title Link
      if (item.hasOwnProperty("Link")) {
        var anchor = clone.getElementById("temp-link");
        anchor.id += index;
        anchor.href = item["Link"];
      }

      document.getElementById(row_id).appendChild(clone);
    }

    //Default Card entry is from New York until someone searches
    entry("New York");
  </script>
  </div>
</body>

</html>